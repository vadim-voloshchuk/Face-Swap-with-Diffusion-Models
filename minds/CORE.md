# üß† –ê–ª–≥–æ—Ä–∏—Ç–º Face Swap & Inpainting

## üîç –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–º–µ–Ω—É –ª–∏—Ü–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∏—Ñ—Ñ—É–∑–∏–æ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤:

1Ô∏è‚É£ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–∏—Ü** ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ–º `dlib` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª–∏—Ü –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫.
2Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏ –ª–∏—Ü–∞** ‚Äì —Ä–∞—Å—à–∏—Ä—è–µ–º –æ–±–ª–∞—Å—Ç—å –º–∞—Å–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–æ–Ω–∞.
3Ô∏è‚É£ **–ö–æ–º–ø–æ–∑–∏—Ü–∏—è –ª–∏—Ü** ‚Äì –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∏ –∑–∞–º–µ–Ω—è–µ–º –ª–∏—Ü–æ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.
4Ô∏è‚É£ **Inpainting (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)** ‚Äì –≤—ã–ø–æ–ª–Ω—è–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —á–∞—Å—Ç–µ–π.
5Ô∏è‚É£ **Blending (—Å–º–µ—à–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)** ‚Äì –º–Ω–æ–≥–æ–ø–æ–ª–æ—Å–Ω–æ–µ —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞.
6Ô∏è‚É£ **Face Restoration (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–∞)** ‚Äì –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CodeFormer –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

## üéØ –ß—Ç–æ —É–¥–∞–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
‚úÖ **–û–Ω–ª–∞–π–Ω-–ø–æ–¥—Ö–æ–¥ –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è** ‚Äì —É–¥–∞–ª–æ—Å—å –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ –¥–æ–ª–≥–æ–≥–æ —ç—Ç–∞–ø–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π.
‚úÖ **–û—Ç–∫–∞–∑ –æ—Ç ArcFace** ‚Äì —Ä–µ—à–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ open-source –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ç–∏–Ω–≥–∞.
‚úÖ **–ì–∏–±–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ inpainting** ‚Äì –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏.

üí° _–ù–∞–∏–±–æ–ª—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–∫–∞–∑—ã–≤–∞–µ—Ç inpainting-–º–æ–¥–µ–ª—å, –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –µ—ë –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏._

---

## üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Python 3.10+** ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫.
- **Pillow** ‚Äì –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
- **OpenCV** ‚Äì —Ñ–∏–ª—å—Ç—Ä—ã –∏ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
- **NumPy** ‚Äì —á–∏—Å–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.
- **dlib** ‚Äì –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–∏—Ü –∏ landmarks.
- **Stable Diffusion** ‚Äì –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
- **AutoPipelineForInpainting** ‚Äì —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π inpainting API.
- **Laplacian Blending** ‚Äì —Ç–µ—Ö–Ω–∏–∫–∞ —Å–º–µ—à–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

---

## üìå –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (Mermaid Diagram)
```mermaid
graph TD;
    A[–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è] -->|–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–∏—Ü–∞| B[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç landmarks];
    B -->|–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏| C[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –º–∞—Å–∫–∏ –ª–∏—Ü–∞];
    C -->|–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ª–∏—Ü–∞| D[–ù–∞–ª–æ–∂–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–≥–æ –ª–∏—Ü–∞];
    D -->|Inpainting —á–µ—Ä–µ–∑ Stable Diffusion| E[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —á–∞—Å—Ç–µ–π];
    E -->|Blending –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞| F[–°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å Laplacian Pyramid];
    F -->|–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–∞| G[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CodeFormer];
    G -->|–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç| H[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è];
```

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### üìå Inpainting —Å —É—á–µ—Ç–æ–º landmark'–æ–≤
```python
result_image = run_inpainting(
    target_img="target.jpg",
    ref_img="reference.jpg",
    strength=0.75,
    guidance_scale=7.5,
    steps=50,
    padding_mask_crop=10,
    model_name="stabilityai/stable-diffusion-inpainting",
    use_blending=True,
    use_face_restoration=True,
    restoration_strength=0.6,
    mask_scale_factor=1.2
)
result_image.save("output.jpg")
```

### üìå –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—Ü–∞ –∏ –µ–≥–æ –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫
```python
from modules.face_detection import detect_face

face_coords, face_img = detect_face("target.jpg")
```

### üìå –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏ –ª–∏—Ü–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
```python
from modules.masking import create_expanded_face_mask
mask = create_expanded_face_mask(image_shape, landmarks, scale_factor=1.2)
```

### üìå –ö–æ–º–ø–æ–∑–∏—Ç–∏–Ω–≥ –ª–∏—Ü–∞ (—Å–æ–≤–º–µ—â–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
```python
from modules.face_composite import composite_face_aligned

composite = composite_face_aligned(target_cv, ref_cv, predictor_path="shape_predictor_68_face_landmarks.dat")
```

### üìå Blending —Å Laplacian Pyramid
```python
from modules.utils import laplacian_blending
blended_image = laplacian_blending(result_np, composite_np, mask_np, levels=5)
```

---

## üìå –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –∞–ª–≥–æ—Ä–∏—Ç–º–∞
1Ô∏è‚É£ **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–∏—Ü–∞**
2Ô∏è‚É£ **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏**
3Ô∏è‚É£ **–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –ª–∏—Ü–∞**
4Ô∏è‚É£ **–ó–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–∏ inpainting —á–µ—Ä–µ–∑ `AutoPipelineForInpainting`**
5Ô∏è‚É£ **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Laplacian Blending –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è –∫—Ä–∞–µ–≤**
6Ô∏è‚É£ **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–∞ —Å CodeFormer**

üí° _–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞._

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](../minds/RESEARCH.md)
- [–û—Å–Ω–æ–≤–Ω–æ–π README](../README.md)

üöÄ **–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞!** üî•
